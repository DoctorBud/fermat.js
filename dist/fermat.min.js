// Fermat Mathematics Tools
// (c) 2014, Mathigon / Philipp Legner
// MIT License (https://github.com/Mathigon/fermat.js/blob/master/LICENSE)

!function(){function a(a){if(a.memo)return a.memo;var b={};return a.memo=function(){var c=f.call(arguments);return void 0!==b[c]?b[c]:b[c]=a.apply(this,arguments)},a.memo}function b(a){for(var b=[],c=0,d=a.length;d>c;++c)b.push(+a[c]);return b}function c(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c]===b)return c;return-1}function d(a,b){return Array.prototype.concat.apply(a,b)}if("object"!=typeof M||!M.core)throw new Error("fermat.js requires core.js.");M.fermat=!0;var e=1e-6;M.PHI=1.618033988749895,M.SQRT2=1.4142135623730951,M.setPrecision=function(a){e=a||1e-6};var f=Array.prototype.join,g=(Array.prototype.push,Array.prototype.slice);!function(){M.nearlyEquals=function(a,b,c){return Math.abs(a-b)<(c||e)},M.sign=Math.sign||function(a){return a>0?1:0>a?-1:0},M.square=function(a){return a*a},M.cube=function(a){return a*a*a},M.bound=function(a,b,c){return null==c&&(c=1/0),null==b&&(b=-1/0),Math.min(c,Math.max(b,a))},M.between=function(a,b,c){return a>=b&&c>=a},M.numberFormat=function(a){a=(""+a).split(".");for(var b=a[0],c=/(\d+)(\d{3})/;c.test(b);)b=b.replace(c,"$1,$2");return b+(a.length>1?"."+a[1]:"")},M.toOrdinal=function(a){if(Math.abs(a)%100>=11&&Math.abs(a)%100<=13)return a+"th";switch(a%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd";default:return a+"th"}},M.digits=function(a){if(0===a)return[0];for(var b=[];a>0;)b.push(a%10),a=Math.floor(a/10);return b},M.fractionalDigits=function(a){var c=""+Math.abs(a-Math.floor(a));return b(c.split(""))},M.decimalPlaces=function(a){var b=""+Math.abs(a);return b=b.split("."),1===b.length?0:b[1].length},M.round=function(a,b){var c=Math.pow(10,b||0);return Math.round(a*c)/c},M.roundTo=function(a,b){return b||(b=1),Math.round(a/b)*b},M.roundTowardsZero=function(a){return 0>a?Math.ceil(a-1e-5):Math.floor(a+1e-5)},M.toFraction=function(a,b){b=b||1e-4;for(var c=[1,0],d=[0,1],e=Math.floor(a),f=a-e;d[0]<=1/b;){if(M.nearlyEquals(c[0]/d[0],b))return[c[0],d[0]];c=[e*c[0]+c[1],c[0]],d=[e*d[0]+d[1],d[0]],e=Math.floor(1/f),f=1/f-e}return[a,1]},M.add=function(){for(var a=0,b=0;b<arguments.length;++b)a+=+arguments[b]||0;return a},M.mult=function(){for(var a=0,b=0;b<arguments.length;++b)a*=+arguments[b]||1;return a},M.subtr=function(a,b){return a-b},M.div=function(a,b){return a/b},M.mod=function(a,b){return(a%b+a)%b},M.log=function(a,b){return M.isNumber(b)?Math.log(a)/Math.log(b):Math.log(a)},M.log10=Math.log10||function(a){return Math.log(a)/Math.log(10)},M.log2=Math.log2||function(a){return Math.log(a)/Math.log(2)},M.cosh=Math.cosh||function(a){return(Math.exp(a)+Math.exp(-a))/2},M.sinh=Math.sinh||function(a){return(Math.exp(a)-Math.exp(-a))/2}}(),function(){var a=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97];M.gcd=function b(a,c){if(arguments.length>2){var d=[].slice.call(arguments,1);return b(a,b.apply(null,d))}var e;for(a=Math.abs(a),c=Math.abs(c);c;)e=a%c,a=c,c=e;return a},M.lcm=function e(a,b){if(arguments.length>2){var c=[].slice.call(arguments,1);return e(a,e.apply(null,c))}return Math.abs(a*b)/M.gcd(a,b)},M.isPrime=function(b){if(1>=b||!M.isInt(b))return!1;if(101>b)return c(a,b)>=0;if(b%2===0)return!1;for(var d=Math.sqrt(b),e=3;d>=e;e+=2)if(b%e===0)return!1;return!0},M.isOdd=function(a){return a%2===1},M.isEven=function(a){return a%2===0},M.primeFactorization=function f(a){if(1===a)return[];if(M.isPrime(a))return[a];for(var b=Math.sqrt(a),c=2;b>=c;++c)if(a%c===0)return d(f(c),f(a/c))},M.primeFactors=function(a){return M.primeFactorization(a).unique()},M.listPrimes=function(a){if(2>a)return[];for(var b=[2],c=3;a>=c;c++){var d=!1;for(var e in b)M.has(b,e)&&(d=d||0===c%b[e]);d||b.push(c)}return b}}(),function(){function b(a){if(1===a.length)return[[],a];for(var c=a.pop(),d=b(a),e=[],f=0;f<d.length;++f){var h=g.call(d[f],0);h.push(c),e.push(d[f],h)}return e}M.factorial=a(function(a){return 0>a?0/0:0===a?1:1>=a?a:a*M.factorial(a-1)}),M.binomial=a(function(a,b){if(0===b)return 1;if(2*b>a)return M.binomial(a,a-b);for(var c=1,d=b;d>0;--d)c*=a-d+1,c/=d;return c}),M.permutations=function(a){function b(a){for(var e=0;e<a.length;e++){var f=a.splice(e,1)[0];d.push(f),0===a.length&&c.push(d.slice()),b(a),a.splice(e,0,f),d.pop()}return c}var c=[],d=[];return b(a)},M.subsets=function(a,c){var d=g.call(a,0),e=b(d);return c&&(e=e.filter(function(a){return a.length===c})),e},M.coinFlips=function(a){for(var b="",c=0;a>c;++c)b+=Math.random()>=.5?"H":"T";return b}}(),function(){M.random={},M.random.integer=function(a,b){return(null==b?0:a)+Math.floor((null==b?a:b-a+1)*Math.random())},M.random.integerArray=function(a){for(var b=[],c=0;a>c;++c)b.push(c);return M.shuffle(b)},M.random.weighted=function(a,b){var c=0;null==b?M.each(a,function(a){c+=+a}):c=b;var d=Math.random()*c,e=0;return M.some(a,function(b,c){return e+=a[c],e>=d?c:void 0})},M.shuffle=function(a){a=g.call(a,0);for(var b,c,d=a.length-1;d;--d)b=Math.floor(Math.random()*(d+1)),c=a[b],a[b]=a[d],a[d]=c;return a},M.random.bernoulli=function(a){return null==a&&(a=.5),a=Math.max(0,Math.min(1,a)),Math.random()<a?1:0},M.random.binomial=function(a,b){null==a&&(a=1),null==b&&(b=.5);for(var c=0,d=0;a>d;++d)c+=M.random.bernoulli(b);return c},M.random.poisson=function(a){if(null==a&&(a=1),0>=a)return 0;for(var b=Math.exp(-a),c=1,d=0;c>b;++d)c*=Math.random();return d-1},M.random.uniform=function(a,b){return null==a&&(a=0),null==b&&(b=1),a+(b-a)*Math.random()},M.random.normal=function(a,b){null==a&&(a=0),null==b&&(b=1);var c=Math.random(),d=Math.random(),e=Math.sqrt(-2*Math.log(c))*Math.cos(2*Math.PI*d);return e*Math.sqrt(b)+a},M.random.exponential=function(a){return null==a&&(a=1),0>=a?0:-Math.log(Math.random())/a},M.random.geometric=function(a){return null==a&&(a=.5),0>=a||a>1?null:Math.floor(Math.log(Math.random())/Math.log(1-a))},M.random.cauchy=function(){var a,b,c;do b=2*Math.random()-1,c=2*Math.random()-1,a=b*b+c*c;while(a>=1);return b/c},M.normalPDF=function(a,b,c){return Math.exp(-M.square(a-b)/(2*c))/Math.sqrt(2*Math.PI*c)}}(),function(){M.mean=M.average=function(a){return a.length?M.total(a)/a.length:0},M.median=function(a){var b=a.length;if(!b)return 0;var c=a.slice(0).sort();return b%2===1?c[Math.floor(b/2)]:(c[b/2-1]+c[b/2])/2},M.mode=function(a){for(var b,c=[],d=-1,e=0;e<a.length;e++)c[a[e]]?(c[a[e]]+=1,c[a[e]]>d&&(d=c[a[e]],b=a[e])):c[a[e]]=1;for(e=0;e<c.length;e++)if(c[e]&&e!==b&&c[e]>=d)return null;return b},M.variance=function(a){var b=a.length;if(!b)return 0;for(var c=M.mean(a),d=0,e=0;b>e;++e)d+=M.square(a[e]-c);return d/(b-1)},M.stdDev=function(a){return Math.sqrt(M.variance(a))},M.covariance=function(a,b){if(a.length!==b.length)throw new Error("Array length mismatch");for(var c=a.length,d=0,e=0;c>e;e++)d+=a[e]*b[e];return(d-a.total()*b.total()/c)/c},M.correlation=function(a,b){if(a.length!==b.length)throw new Error("Array length mismatch");var c=M.covariance(a,b),d=a.standardDev(),e=b.standardDev();return c/(d*e)},M.rSquared=function(a,b){var c=a.each(function(a,c){return M.square(a-b[c])}).sum(),d=a.each(function(b){return M.square(b-a.average())}).sum();return 1-c/d},M.linearRegression=function(a,b){var c=a.length,d=a.sum(),e=b.sum(),f=a.each(function(a,c){return a*b[c]}).sum(),g=a.each(function(a){return a*a}).sum(),h=a.average(),i=b.average(),j=(f-1/c*d*e)/(g-1/c*d*d),k=i-j*h;return function(a){return k+j*a}}}(),function(){M.Complex=function(a,b){this.re=a||0,this.im=b||0},M.extend(M.Complex.prototype,{toString:function(){return this.real?this.imaginary?this.real+" + "+this.imaginary+"i":this.real:this.imaginary+"i"},magnitude:function(){return Math.sqrt(this.re*this.re+this.im*this.im)},phase:function(){return Math.atan2(this.im,this.re)},conjugate:function(){return new M.complex(this.re,-this.im)}},!0),M.complex={},M.complex.add=function(a,b){return a instanceof M.Complex||(a=new M.Complex(a,0)),b instanceof M.Complex||(b=new M.Complex(b,0)),new M.Complex(a.re+b.re,a.im+b.im)},M.complex.subtr=function(a,b){return a instanceof M.Complex||(a=new M.Complex(a,0)),b instanceof M.Complex||(b=new M.Complex(b,0)),new M.Complex(a.re-b.re,a.im-b.im)},M.complex.mult=function(a,b){a instanceof M.Complex||(a=new M.Complex(a,0)),b instanceof M.Complex||(b=new M.Complex(b,0));var c=a.re*b.re-a.im*b.im,d=a.im*b.re+a.re*b.im;return new M.complex(c,d)},M.complex.div=function(a,b){if(a instanceof M.Complex||(a=new M.Complex(a,0)),b instanceof M.Complex||(b=new M.Complex(b,0)),Math.abs(b.re)<e&&Math.abs(b.im)<e)return new M.Complex(1/0,1/0);var c=b.re*b.re+b.im*b.im,d=(a.re*b.re+a.im*b.im)/c,f=(a.im*b.re-a.re*b.im)/c;return new M.Complex(d,f)}}(),function(){var a=Object.setPrototypeOf||function(a,b){a.__proto__=b};M.Vector=function(b,c){var d;if(Array.isArray(b))d=b.slice(0);else{d=[],void 0===c&&(c=null);for(var e=0;b>e;++e)d.push(c)}return a(d,M.Vector.prototype),d},M.Vector.prototype=new Array,M.extend(M.Vector.prototype,{total:function(){return M.total(this)},average:function(){return this.total()/this.length},norm:function(){for(var a=0,b=0;b<this.length;++b)a+=M.square(this[b]);return Math.sqrt(a)},normalize:function(){for(var a=[],b=this.length,c=this.norm(),d=0;b>d;++d)a.push(this[d]/c);return M.Vector(a)},toString:function(){return"("+f.call(this,", ")+")"}},!0),M.vector={},M.vector.dot=function(a,b){for(var c=Math.max(a.length,b.length),d=0,e=0;c>e;++e)d+=(a[e]||0)*(b[e]||0);return d},M.vector.cross2D=function(a,b){return a[0]*b[1]-a[1]*b[0]},M.vector.cross=function(a,b){return M.Vector([a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]])},M.vector.mult=function(a,b){return M.Vector(M.map(function(a){return a*b},a))}}(),function(){M.Matrix=function(a,b,c){if(!(this instanceof M.Matrix))return new M.Matrix(a,b,c);var d=M.isArray(a);this.rows=d?a.length:a,this.columns=d?a.each(function(a){return a.length}).max():null!=b?b:a;for(var e=0;e<this.rows;++e){this[e]=[];for(var f=0;f<this.columns;++f){var g=d?a[e][f]:c;this[e][f]=null!=g?g:null}}},M.Matrix.prototype.isSquare=function(){return this.rows===this.cols},M.Matrix.prototype.row=function(a){return new M.Vector(this[a])},M.Matrix.prototype.column=function(a){for(var b=[],c=0;c<this.rows;++c)b.push(this[c][a]);return new M.Vector(b)},M.Matrix.prototype.transpose=function(){for(var a=[],b=0;b<this.columns;++b){this[b]=[];for(var c=0;c<this.rows;++c)a[b][c]=this[c][b]}return new M.Matrix(a)},M.Matrix.prototype.determinant=function(){if(!this.isSquare())throw new Error("Not a square matrix.");var a=this.rows,b=0;if(1===a)return this[0][0];if(2===a)return this[0][0]*this[1][1]-this[0][1]*this[1][0];for(var c=0;c<this.cols;++c){for(var d=this[0][c],e=this[0][c],f=1;rows>f;++f)e*=this[f][M.mod(c+f,a)],d*=this[f][M.mod(c-f,a)];b+=e-d}return b},M.Matrix.prototype.scalarMultiply=function(a){for(var b=[],c=0;c<this.rows;c++){b[c]=[];for(var d=0;d<this.columns;d++)b[c][d]=a*this[c][d]}return M.Matrix(b)},M.Matrix.prototype.inverse=function(){},M.matrix={},M.matrix.identity=function(){for(var a=new M.Matrix(n,n,0),b=0;n>b;++b)a[b][b]=1;return a},M.matrix.add=function(a,b){if(a.rows!==b.rows||a.cols!==b.cols)throw new Error("Matrix size mismatch");for(var c=[],d=0;d<a.length;++d){c[d]=[];for(var e=0;e<a[d].length;++e)c[d][e]=a[d][e]+b[d][e]}return M.Matrix(c)},M.matrix.rotation=function(){},M.matrix.shear=function(){},M.matrix.reflection=function(){},M.matrix.projection=function(){};var a=function(a,c){return b(c.transpose(),a)},b=function(){},c=function(){};M.matrix.mult=function(d,e){if(d instanceof M.Vector&&e instanceof M.Matrix)return a(d,e);if(d instanceof M.Matrix&&e instanceof M.Vector)return b(d,e);if(d instanceof M.Matrix&&e instanceof M.Matrix)return c(d,e);throw new Error("Can't multiply two vectors; use .dot or .cross instead.")}}(),function(){M.geo={},M.geo.Point=function(a,b){this.x=this[0]=+a||0,this.y=this[1]=+b||0,this.length=2},M.geo.Line=function(a,b){this.p1=a,this.p2=b},M.geo.Curve=function(a,b,c,d){null==c&&(c=a),null==d&&(c=b),this.p1=a,this.p2=b,this.q1=c,this.q2=d},M.geo.Circle=function(a,b){this.c=null==b?new M.Point(0,0):a,this.r=null==b?1:b},M.geo.Rect=function(a,b,c,d){this.x=a||0,this.y=b||0,this.w=null==c?c:1,this.h=null==d?d:1},M.geo.Polygon=function(a){this.points=a};var a=function(a){return a instanceof M.geo.Point?"point":a instanceof M.geo.Line?"line":a instanceof M.geo.Circle?"circle":a instanceof M.geo.Rect?"rect":a instanceof M.geo.Polygon?"polygon":""};M.geo.angle=function(a,b,c){var d=Math.atan2(a.y-b.y,a.x-b.x),e=Math.atan2(c.y-b.y,c.x-b.x),f=e-d;return 0>f&&(f+=2*Math.PI),f},M.geo.Rect.prototype.toPolygon=function(){var a=new M.geo.Point(this.x,this.y),b=new M.geo.Point(this.x+this.w,this.y),c=new M.geo.Point(this.x+this.w,this.y+this.h),d=new M.geo.Point(this.x,this.y+this.h);return new M.geo.Polygon([a,b,c,d])},M.geo.isParallel=function(a,b){var c=a.p2.x-a.p1.x,d=a.p2.y-a.p1.y,e=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;return 0===c&&0===e||0===d&&0===f||M.nearlyEquals(d/c,f/e)},M.geo.Line.prototype.contains=function(a){var b=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),c=(a.y-this.p1.y)/(a-this.p1.x);return M.nearlyEquals(b,c)},M.geo.Line.prototype.normalVector=function(){var a=this.length(),b=(this.p2.x-this.p1.x)/a,c=(this.p2.y-this.p1.y)/a;return new M.Point(b,c)},M.geo.project=function(a,b){var c=M.vector.dot(M.vector.subtr(a,b.p1),b.normalVector());return new M.geo.Point(b.p1.x+c.x,b.p1.y+c.y)},M.geo.lineToPointDistance=function(a,b){return M.geo.distance(a,M.geo.project(a,b))},M.geo.Polygon.prototype.centroid=function(){},M.geo.Line.prototype.at=function(a){var b=a*this.p1.x+(1-a)*this.p2.x,c=a*this.p1.y+(1-a)*this.p2.y;return new M.geo.Point(b,c)},M.geo.Circle.prototype.at=function(){},M.geo.Rect.prototype.at=function(){},M.geo.Polygon.prototype.at=function(){},M.geo.Curve.prototype.at=function(a){var b=M.cube(1-a)*this.p1.x+3*a*(1-a)*(1-a)*this.q1.x+3*a*a*(1-a)*this.q2.x+M.cube(a)*this.p2.x,c=M.cube(1-a)*this.p1.y+3*a*(1-a)*(1-a)*this.q1.y+3*a*a*(1-a)*this.q2.y+M.cube(a)*this.p2.y;return new M.geo.Point(b,c)},M.geo.average=function(a){var b=a.each(function(a){return a.x}).total()/a.length,c=a.each(function(a){return a.y}).total()/a.length;return new M.geo.Point(b,c)},M.geo.distance=function(a,b){return Math.sqrt(M.square(a.x-b.x)+M.square(a.y-b.y))},M.geo.manhatten=function(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)},M.geo.Line.prototype.length=function(){return M.geo.distance(this.p1,this.p2)},M.geo.Curve.prototype.length=function(){},M.geo.Circle.prototype.circumference=function(){return 2*Math.PI*this.r},M.geo.Rect.prototype.circumference=function(){return 2*this.w+2*this.h},M.geo.Polygon.prototype.circumference=function(){for(var a=0,b=this.points,c=b.length,d=1;c>d;++d)a+=M.geo.distance(b[d-1],b[d]);return a+=M.geo.distance(b[c-1],b[0])},M.geo.Circle.prototype.area=function(){return Math.PI*M.square(this.r)},M.geo.Rect.prototype.area=function(){return Math.abs(this.w*this.h)},M.geo.Polygon.prototype.area=function(){for(var a=this.points,b=a.length,c=a[0].x*a[b-1].y-a[b-1].x*a[0].y,d=1;b>d;++d)c+=a[d-1].x*a[d].y-a[d].x*a[d-1].y;return Math.abs(c/2)};var b={point:function(a,b){return M.nearlyEquals(a.x,b.x)&&M.nearlyEquals(a.y,b.y)},line:function(a,c,d){return b.point(a.p1,c.p1)&&b.point(a.p2,c.p2)||d&&b.point(a.p1,c.p2)&&b.point(a.p2,c.p1)},rect:function(){},circle:function(){},polygon:function(){}};M.geo.same=function k(b,c,d){var e=a(b);if(e!==a(c))return!1;var f=k[e];return f?f(b,c,d):void 0},M.geo.Point.prototype.transform=function(a){var b=a[0][0]*this.x+a[0][1]*this.y,c=a[1][0]*this.x+a[1][1]*this.y;return new M.geo.Point(b,c)};var c=function(a,b,c){return new M.geo.Point(a.x*b,a.y*c)};M.geo.scale=function(b,d,e){null==e&&(e=d),b instanceof M.geo.Rect&&(b=b.toPolygon());var f=a(b);switch(f){case"point":return c(b,d,e);case"line":return new M.geo.Line(c(b.p1,d,e),c(b.p2,d,e));case"circle":return new M.geo.Circle(c(b.c,d,e),b.r*(d+e)/2);case"polygon":return new M.geo.Polygon(b.points.map(function(a){return c(a,d,e)}))}};var d=function(a,b){var c=b.p2.x-b.p1.x,d=b.p2.y-b.p1.y,e=a.x-b.p1.x,f=a.y-b.p1.y,g=(c*f-d*e)/(c*c+d*d),h=a.x+2*g*d,i=a.y-2*g*c;return new M.geo.Point(h,i)};M.geo.reflection=function(b,c){b instanceof M.geo.Rect&&(b=b.toPolygon());var e=a(b);switch(e){case"point":return d(b,c);case"line":return new M.geo.Line(d(b.p1,c),d(b.p2,c));case"circle":return new M.geo.Circle(d(b.c,c),b.r);case"polygon":return new M.geo.Polygon(b.points.map(function(a){return d(a,c)}))}};var e=function(a,b,c){var d=a.x-b.x,e=a.y-b.y,f=Math.cos(c),g=Math.sin(c),h=d*f-e*g+b.x,i=d*g+e*f+b.y;return new M.geo.Point(h,i)};M.geo.rotation=function(b,c,d){b instanceof M.geo.Rect&&(b=b.toPolygon());var f=a(b);switch(f){case"point":return e(b,c,d);case"line":return new M.geo.Line(e(b.p1,c,d),e(b.p2,c,d));case"circle":return new M.geo.Circle(e(b.c,c,d),b.r);case"polygon":return new M.geo.Polygon(b.points.map(function(a){return e(a,c,d)}))}},M.geo.angleBisector=function(a,b,c){var d=Math.atan2(a.y-b.y,a.x-b.x),e=Math.atan2(c.y-b.y,c.x-b.x),f=(d+e)/2;d>e&&(f+=Math.PI);var g=Math.cos(f)+b.x,h=Math.sin(f)+b.y;return new M.geo.Point(g,h)},M.geo.perpendicular=function(a,b){var c,d;if(M.geo.same(b,a.p1))c=a.p2.y-a.p1.y,d=a.p1.x-a.p2.x;else if(M.geo.same(b===a.p2))c=a.p1.y-a.p2.y,d=a.p2.x-a.p1.x;else if(a.contains(b))c=a.p1.y-b.y,d=b.x-a.p1.x;else{var e=M.geo.project(b,a);c=e.x,d=e.y}return new M.geo.Line(new M.geo.Point(b.x,b.y),new M.geo.Point(b.x+c,b.y+d))},M.geo.sortVertices=function(){},M.geo.convexHull=function(){},M.geo.travellingSalesman=function(a){var b=a.length,c=M.list(b),d=1/0,e=null;return M.permutations(c).each(function(c){for(var f=0,g=0;b-1>g;++g)if(f+=a[c[g]][c[g+1]],f>d)return;d>f&&(d=f),e=c}),{path:e,length:d}};M.geo.lineIntersect=function(a,b){var c=[a.p2.x-a.p1.x,a.p2.y-a.p1.y],d=[b.p2.x-b.p1.x,b.p2.y-b.p1.y],e=[b.p1.x-a.p1.x,b.p1.y-a.p1.y],f=M.vector.cross2D(d,c);if(0!==f){var g=M.vector.cross2D(c,e),h=M.vector.cross2D(d,e),i=h/f,j=g/f;if(M.between(i,0,1)&&M.between(j,0,1)){var k=a.p1.x+i*(a.p2.x-a.p1.x),l=a.p1.y+j*(a.p2.y-a.p1.y);return[k,l]}}};var f=function(){},h=function(){},i=function(){},j=function(){};M.geo.intersect=function(b,c){if(arguments.length>2){var d=g.call(arguments,1);return M.geo.intersect(b,M.geo.intersect.apply(null,d))}if(b instanceof M.geo.Rect&&c instanceof M.geo.Rect)return i(b,c);switch(b instanceof M.geo.Rect&&(b=b.toPolygon()),c instanceof M.geo.Rect&&(c=c.toPolygon()),a(b)+"-"+a(c)){case"line-line":return M.geo.lineIntersect(b,c);case"line-circle":return f(b,c);case"line-polygon":return h(b,c);case"circle-line":return f(c,b);case"polygon-line":return h(c,b);case"polygon-polygon":return j(b,c)}throw new Error("Can't intersect "+a(b)+"s and "+a(c)+".")}}(),function(){var a="abcdefghijklmnopqrstuvwxyz",b="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c={a:.08167,b:.01492,c:.02782,d:.04253,e:.12702,f:.02228,g:.02015,h:.06094,i:.06966,j:.00154,k:.00772,l:.04024,m:.02406,n:.06749,o:.07507,p:.01929,q:95e-5,r:.05987,s:.06327,t:.09056,u:.02758,v:.00978,w:.0236,x:.0015,y:.01974,z:74e-5};M.caesarCypher=function(c,d){for(var e="",f=0,g=c.length;g>f;f++)e+=c[f]>="a"&&c[f]<="z"?a[(a.indexOf(c[f])+d)%26]:c[f]>="A"&&c[f]<="Z"?b[(b.indexOf(c[f])+d)%26]:c[f];return e},M.vigenereCypher=function(c,d){for(var e="",f=0,g=0,h=d.toLowerCase(),i=0,j=c.length,k=h.length;j>i;i++)f=a.indexOf(h[g%k]),c[i]>="a"&&c[i]<="z"?(e+=a[(a.indexOf(c[i])+f)%26],g++):c[i]>="A"&&c[i]<="Z"?(e+=b[(b.indexOf(c[i])+f)%26],g++):e+=c[i];return e},M.letterFreqency=function(a){return c[a.toLowerCase()]},M.cipherLetterFreq=function(b){for(var c=b.toLowerCase(),d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0,f=c.length;f>e;++e)c[e]>="a"&&c[e]<="z"&&d[a.indexOf(c[e])]++;return d}}(),function(){M.bisect=function(a,b,c,d){null==b&&(b=3);var e=Math.pow(10,-b),f=Math.pow(10,b);c||(c=0);var g=a(c),h=Math.sign(g);if(0===h)return c;var i,j;if(null==d){d=.5;do d*=2,i=a(d),j=Math.sign(i);while(j===h);if(0===j)return d}for(var k=0;Math.abs(g)>e&&200>k;){var l=(c+d)/2,m=a(l),n=Math.sign(m);if(0===n)return l;n===h?(c=l,g=m):(d=l,i=m),++k}return Math.round(c*f)*e}}(),function(){var a={da:{name:"deca",value:10},h:{name:"hecto",value:100},k:{name:"kilo",value:1e3},M:{name:"mega",value:1e6},G:{name:"giga",value:1e9},T:{name:"tera",value:1e12},P:{name:"peta",value:1e15},E:{name:"exa",value:1e18},Z:{name:"zetta",value:1e21},Y:{name:"yotta",value:1e24},d:{name:"deci",value:.1},c:{name:"centi",value:.01},m:{name:"milli",value:.001},u:{name:"micro",value:1e-6},n:{name:"nano",value:1e-9},p:{name:"pico",value:1e-12},f:{name:"femto",value:1e-15},a:{name:"atto",value:1e-18},z:{name:"zepto",value:1e-21},y:{name:"yocto",value:1e-24}},b={m:{name:"meter",type:"length",value:1},"in":{name:"inch",type:"length",value:.0254},ft:{name:"foot",type:"length",value:.3048},yd:{name:"yard",type:"length",value:.9144},mi:{name:"mile",type:"length",value:1609.344},AA:{name:"angstrom",type:"length",value:1e-10},m2:{name:"m2",type:"surface",power:2,value:1},sqin:{name:"sqin",type:"surface",power:2,value:64516e-8},sqft:{name:"sqft",type:"surface",power:2,value:.09290304},sqyd:{name:"sqyd",type:"surface",power:2,value:.83612736},sqmi:{name:"sqmi",type:"surface",power:2,value:2589988.110336},m3:{name:"m3",type:"volume",value:1},l:{name:"litre",type:"volume",value:.001},cup:{name:"cup",type:"volume",value:.0002365882},pint:{name:"pint",type:"volume",value:.0004731765},quart:{name:"quart",type:"volume",value:.0009463529},gallon:{name:"gallon",type:"volume",value:.003785412},barrel:{name:"barrel",type:"volume",value:.1589873},g:{name:"gram",type:"mass",value:.001},ton:{name:"ton",type:"mass",value:907.18474},oz:{name:"ounce",type:"mass",value:.028349523125},lbm:{name:"pound",type:"mass",value:.45359237},s:{name:"second",type:"time",value:1},min:{name:"minute",type:"time",value:60},h:{name:"hour",type:"time",value:3600},d:{name:"day",type:"time",value:86400},w:{name:"week",type:"time",value:604800},mon:{name:"month",type:"time",value:2629740},y:{name:"year",type:"time",value:31556900},rad:{name:"rad",type:"angle",value:1},deg:{name:"deg",type:"angle",value:.017453292519943295},grad:{name:"grad",type:"angle",value:.015707963267948967},cyc:{name:"cycle",type:"angle",value:6.283185307179586},A:{name:"ampere",type:"current",value:1},K:{name:"kelvin",type:"temperature",value:1},degC:{name:"celsius",type:"temperature",value:1,offset:273.15},degF:{name:"fahrenheit",type:"temperature",value:1/1.8,offset:459.67},mol:{name:"mole",type:"substance",value:1},N:{name:"newton",type:"force",value:1},lbf:{name:"poundforce",type:"force",value:4.4482216152605},b:{name:"bits",type:"data",value:1},B:{name:"bytes",type:"data",value:8}};M.unit={};var c=M.object.keys(a).join("|"),d=M.object.keys(b).join("|"),e=new RegExp("^("+c+")?("+d+")$");M.unit.to=function(c,d,f){var g=d.match(e),h=g[1],i=g[2],j=h?a[h].value||0:1,k=b[i].value||1,l=b[i].offset||0,m=(c*k+l)*j;return null==f?m:(g=f.match(e),h=g[1],i=g[2],j=h?a[h].value||0:1,k=b[i].value||1,l=b[i].offset||0,(m/j-l)/k)},M.unit.define=function(c){c=c.match(e);var d=c[1]?a[c[1]].name:"",f=b[c[2]].name;return d+f}}(),function(){function a(a,b){return e[a]===b||e[b]===a}function b(){this.current="",this.result=[],this.currentParser=null,this.currentBracket=null,this.currentFn=null}function c(a,b){this.fn=a,this.args=b}function d(a){this.val=a}var e={"(":")","[":"]","{":"}","|":"|"};b.prototype.send=function(e){if('"'===this.currentBracket&&'"'!==e)this.current+=e;else if(this.currentBracket||'"'!==e)if('"'===this.currentBracket&&'"'===e)this.result.push(new Expression('"',[this.current]));else{if("@&\\?<>=~`±§".contains(e))throw new Error('Unexpected "'+e+'".');if(this.currentParser)if(")]}|".contains(e)&&this.currentParser.isReady()){if(!a(e,this.currentBracket))throw new Error('Unexpected "'+e+'".');var f=this.currentParser.complete();if(this.currentFn)this.result.push(new c(this.currentFn,f));else if("]"===e)this.result.push(new c("[]",f));else if("|"===e)this.result.push(new c("abs",f));else{if(1!==f.length)throw new Error('Unexpected ",".');this.result.push(new d(f[0]))}this.current="",this.currentBracket=this.currentParser=this.currentFn=null}else this.currentParser.send(e);else"([{|".contains(e)?("("===e&&isNaN(+this.current)&&!"+-*/!^%,".contains(this.current)?(this.currentFn=this.current,this.current=""):this.pushCurrent(),this.currentParser=new b,this.currentBracket=e):"+-*/!^%,".contains(e)?(this.pushCurrent(),","!==e&&this.result.push(e)):e.match(/\s\n\t/)?this.pushCurrent():this.current+=e.trim()}else this.pushCurrent(),this.currentBracket='"'},b.prototype.isReady=function(){return null==this.currentParser},b.prototype.pushCurrent=function(){if(this.current){var a=+this.current;this.result.push(new d(a===a?a:this.current)),this.current=""}},b.prototype.complete=function(){this.pushCurrent();var a;for(a=0;a<this.result.length;++a)"!"===this.result[a]?(this.result.splice(a-1,2,new c("!",[this.result[a-1]])),a-=1):"%"===this.result[a]&&(this.result.splice(a-1,2,new c("/",[this.result[a-1],100])),a-=1);for(a=0;a<this.result.length;++a)"^"===this.result[a]&&(this.result.splice(a-1,3,new c("^",[this.result[a-1],this.result[a+1]])),a-=2);for("-"===this.result[0]&&this.result.splice(0,2,new c("-",[this.result[1]])),a=0;a<this.result.length;++a)"/"===this.result[a]?(this.result.splice(a-1,3,new c("/",[this.result[a-1],this.result[a+1]])),a-=2):"*"===this.result[a]&&(this.result.splice(a-1,3,new c("*",[this.result[a-1],this.result[a+1]])),a-=2);for(a=0;a<this.result.length;++a)"-"===this.result[a]?(this.result.splice(a-1,3,new c("-",[this.result[a-1],this.result[a+1]])),a-=2):"+"===this.result[a]&&(this.result.splice(a-1,3,new c("+",[this.result[a-1],this.result[a+1]])),a-=2);return this.result},c.prototype.simplify=function(){return this},c.prototype.toString=function(){for(var a=[],b=0;b<this.args.length;++b)a.push(this.args[b].toString());var c=g[this.fn];return c?c.apply(null,a):this.fn+"("+this.args.join(", ")+")"},c.prototype.evaluate=function(a){null==a&&(a={});for(var b=[],c=0;c<this.args.length;++c){var d=this.args[c].evaluate();if(d instanceof Expression)return this;b.push(d)}var e=a[this.fn]||f[this.fn]||Math[this.fn]||M[this.fn];return e instanceof Function?e.apply(null,b):this},d.prototype.simplify=function(){return this},d.prototype.toString=function(){return this.val.toString()},d.prototype.evaluate=function(a){return null==a&&(a={}),void 0===a[this.val]?this.val:a[this.val]};var f={"+":function(a,b){return a+b},"-":function(a,b){return void 0===b?-a:a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"!":function(a){return M.factorial(a)},"^":function(a,b){return Math.pow(a,b)},"[]":function(){return arguments},'"':function(a){return""+a},mod:function(a,b){return M.mod(a,b)}},g={"+":function(){return M.toArray(arguments).join(" + ")},"-":function(a,b){return void 0===b?"-"+a:a+" - "+b},"*":function(){return M.toArray(arguments).join(" * ")},"/":function(a,b){return a+" / "+b},"!":function(a){return a+"!"},"^":function(a,b){return a+" ^ "+b},"[]":function(){return"["+M.toArray(arguments).join(", ")+"]"},'"':function(a){return'"'+a+'"'},mod:function(a,b){return a+" mod "+b}};M.expression={},M.expression.parse=function(a){for(var c=new b,d=a.length,e=0;d>e;++e)c.send(a[e]);return c.complete()[0].simplify()}}()}();